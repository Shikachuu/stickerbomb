apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: labelers.stickerbomb.dev
spec:
  group: stickerbomb.dev
  names:
    categories: []
    kind: Labeler
    plural: labelers
    shortNames:
    - doc
    singular: labeler
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for LabelerSpec via `CustomResource`
        properties:
          spec:
            description: Spec object for the `Labeler` CRD
            properties:
              labels:
                additionalProperties:
                  type: string
                description: List of labels to apply (must contain at least one label)
                type: object
              rego:
                description: |-
                  Contains the labeling policy described in Rego.
                  For refference check out [OPA's documentation on rego](https://www.openpolicyagent.org/docs/policy-language).
                  This operator uses [Microsoft's regorus](https://github.com/microsoft/regorus/tree/main) implementation,
                  you can write and test some conditions on the [regorus playground](https://anakrish.github.io/regorus-playground/).
                nullable: true
                properties:
                  policy:
                    description: Policy defines the rego policy that will be used in the engine as context for the query
                    maxLength: 65536
                    minLength: 1
                    type: string
                  query:
                    description: |-
                      Query defines the rego query the engine will evaluate as boolean to decide if the resource
                      requires labeling.
                      Only use boolean conditions otherwise you will get a runtime error!
                    maxLength: 1024
                    minLength: 1
                    type: string
                required:
                - policy
                - query
                type: object
              resourceApi:
                description: |-
                  Describes the target api group of the target resource (e.g., "v1", "apps/v1", "cert-manager.io/v1").
                  Use "kubectl api-resources" for a complete list of supported resources.
                maxLength: 253
                minLength: 1
                pattern: ^([a-z0-9]([a-z0-9.-]*[a-z0-9])?/)?[a-z0-9]([a-z0-9-]*[a-z0-9])?$
                type: string
              resourceKind:
                description: |-
                  Describes the target kind of the target resource (e.g., "Pod", "Deployment").
                  Use "kubectl api-resources" for a complete list of supported resources.
                maxLength: 63
                minLength: 1
                pattern: ^[A-Z][a-zA-Z0-9]*$
                type: string
            required:
            - labels
            - resourceApi
            - resourceKind
            type: object
          status:
            description: State object for the `Labeler` CRD
            nullable: true
            properties:
              resourcesLabeled:
                description: Number of resources labeled in last reconciliation
                format: int32
                minimum: 0.0
                type: integer
              resourcesMatched:
                description: Number of resources that matched `resource_kind`
                format: int32
                minimum: 0.0
                type: integer
              resourcesSkipped:
                description: Number of resources failed the rego condition evaluation
                format: int32
                minimum: 0.0
                type: integer
            required:
            - resourcesLabeled
            - resourcesMatched
            - resourcesSkipped
            type: object
        required:
        - spec
        title: Labeler
        type: object
    served: true
    storage: true
    subresources:
      status: {}
